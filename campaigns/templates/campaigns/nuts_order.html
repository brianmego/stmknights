{% extends 'campaigns/sales.html' %}


{% block container_content %}
    <form method="POST" class="sales-form">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-3">
                <strong>Product</strong>
            </div>
            <div class="col-md-2">
                <strong>Weight</strong>
            </div>
            <div class="col-md-2">
                <strong>Add to Cart</strong>
            </div>
            <div class="col-md-1">
                <strong>Cost</strong>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <br>
        {% for product in products %}
            <div class="row">
                <div class="col-md-3">
                    <strong>
                        {{ product.name }}
                    </strong>
                </div>
                <div class="col-md-2">
                    {{ product.meta_field_one }}
                </div>
                <div class="col-md-2">
                    <input class='product-input' id="product-{{ product.id }}" name="product-{{ product.id }}" min="0" type="number">
                </div>
                <div id="product-{{ product.id }}-cost" class="col-md-1">
                    ${{ product.cost }}
                </div>
                <div class="col-md-4">
                    <img src=/static/campaigns/img/nuts/{{ product.meta_field_two }} width=50%>
                </div>
            </div>
            <br>
        {% endfor %}

        <div class="row">
            <div class="col-md-6">
                <strong>Total</strong>
            </div>
            <div class="col-md-6">
                <p id="total">$0</p>
            </div>
        </div>
        <div class="row">
            <button type="submit" class="save btn btn-default">Submit</button>
        </div>
    </form>

    <script type="text/javascript">
    $(document).ready(function() {
        set_input_events()
    });


    function set_input_events() {
        $('input').blur(calculateTotal);
    }

    function calculateTotal() {
        var total = 0
        $('.product-input')
        .each( 
            function() {
                total += (
                    $('#' + $(this).attr('id') + '-cost')
                        .text()
                        .trim()
                        .substr(1)
                    ) *
                    $(this).val()
            }
        );
        $('#total').text('$' + total);
    }

    </script>

{% endblock %}
